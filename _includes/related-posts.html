<div class="related-posts">
    {% assign hasSimilar = '' %}
    {% for post in site.related_posts %}
        {% assign postHasSimilar = false %}
        {% for tag in post.tags %}
            {% if postHasSimilar == false %}
                {% for thisTag in page.tags %}
                    {% if postHasSimilar == false and hasSimilar.size < 5 and post != page and tag == thisTag %}
                        {% if hasSimilar.size == 0 %}
                            <h3>相关文章:</h3>
                            <ul>
                        {% endif %}
                        <li> <span class="post-meta">{{ post.date | date: "%Y-%m-%d" }}</span>
                        <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a>
                        </li>
                        {% assign postHasSimilar = true %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}

        {% if postHasSimilar == true %}
            {% capture hasSimilar %}{{ hasSimilar }}*{% endcapture %}
        {% endif %}
    {% endfor %}

    {% if hasSimilar.size > 0 %}
    </ul>
    {% endif %}
</div>
